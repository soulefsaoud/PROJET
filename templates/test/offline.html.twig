{# templates/test/offline.html.twig #}
<div class="container mt-4">
    <h1>ğŸ”Œ Test Mode Offline</h1>

    <div class="alert alert-info">
        <strong>Instructions :</strong>
        <ol>
            <li>Ouvrez DevTools â†’ Network</li>
            <li>Cochez "Offline"</li>
            <li>Testez les fonctionnalitÃ©s ci-dessous</li>
        </ol>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">ğŸ“± Status RÃ©seau</div>
                <div class="card-body">
                    <p id="network-status"></p>
                    <p id="last-update"></p>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">ğŸ’¾ Cache Test</div>
                <div class="card-body">
                    <button id="test-cache" class="btn btn-primary">
                        Test Cache Recettes
                    </button>
                    <div id="cache-result"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Test de gÃ©nÃ©ration offline -->
    <div class="mt-4">
        <h3>ğŸ§ª Test GÃ©nÃ©ration Recettes Offline</h3>
        <form id="offline-form">
            <input type="text" placeholder="tomate, basilic" id="offline-ingredients">
            <button type="submit">GÃ©nÃ©rer (test offline)</button>
        </form>
        <div id="offline-results"></div>
    </div>
</div>

<script>
    // Test rÃ©seau
    function updateNetworkStatus() {
        const status = navigator.onLine ? 'ğŸŸ¢ En ligne' : 'ğŸ”´ Hors ligne';
        document.getElementById('network-status').textContent = status;
        document.getElementById('last-update').textContent = 'MAJ: ' + new Date().toLocaleTimeString();
    }

    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);
    updateNetworkStatus();

    // Test cache
    document.getElementById('test-cache').addEventListener('click', async () => {
        try {
            const response = await fetch('/api/ai-recipes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ingredients: ['test', 'cache'] })
            });

            if (response.ok) {
                document.getElementById('cache-result').innerHTML = 'âœ… Cache fonctionne';
            } else {
                document.getElementById('cache-result').innerHTML = 'âŒ Erreur: ' + response.status;
            }
        } catch (error) {
            document.getElementById('cache-result').innerHTML = 'âš ï¸ Mode offline: ' + error.message;
        }
    });

    // Test form offline
    document.getElementById('offline-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!navigator.onLine) {
            // Mode offline : chercher en cache local
            const cached = localStorage.getItem('lastRecipes');
            if (cached) {
                document.getElementById('offline-results').innerHTML =
                    'ğŸ’¾ Recettes depuis le cache local<br>' +
                    JSON.parse(cached).recipes.map(r => r.nom).join(', ');
            } else {
                document.getElementById('offline-results').innerHTML =
                    'âŒ Aucune recette en cache. Connectez-vous d\'abord.';
            }
        } else {
            document.getElementById('offline-results').innerHTML = 'ğŸŒ Mode en ligne dÃ©tectÃ©';
        }
    });
</script>
